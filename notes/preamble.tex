% Packages
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{multicol}
\usepackage{amsmath, amssymb, amsthm, mathtools, bm}
\usepackage{geometry}
\usepackage{lipsum} % For filler text
\usepackage{array} % For better table formatting
\usepackage{float} % For forcing table placement
\usepackage{cite} % For citation
\usepackage{setspace} % For adjusting line spacing
\usepackage{listings}
\usepackage{hyperref}
\usepackage{xcolor}
\usepackage[utf8]{inputenc}
\usepackage{caption}
\usepackage{witharrows}
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{amsopn}
\usepackage{fancybox}
\usepackage{todonotes}
\usepackage[dvipsnames]{xcolor}
\usepackage{mdframed}      % boxed theorems
\usepackage{thmtools}      % couples well with mdframed
\captionsetup[lstlisting]{font={small}, labelfont={bf}, labelsep=colon}
\renewcommand{\lstlistingname}{Code}
% Define a theorem style that uses mdframed for the box
\declaretheoremstyle[
  headfont=\normalfont\bfseries,
  mdframed={
    linewidth=0.5pt,
    roundcorner=4pt,
    backgroundcolor={gray!5},
    innertopmargin=6pt,
    innerbottommargin=6pt,
    innerleftmargin=8pt,
    innerrightmargin=8pt
  }
]{boxed}

% Create the “assumption” environment, numbered within each section
\declaretheorem[
  name=Assumption,
  style=boxed,
  numberwithin=section
]{assumption}



% Page setup
\geometry{letterpaper, margin=1in}
\setlength{\parindent}{0pt}
\linespread{1.25}
\renewcommand{\arraystretch}{1.25} % Adjust as needed

% Define solution environment and commonly used commands
\newenvironment{solution}
  {\renewcommand\qedsymbol{$\blacksquare$}\begin{proof}[\textbf{Solution}]}
  {\end{proof}}
\newtheorem{lemma}{Lemma}
  \renewcommand{\thelemma}{\Alph{lemma}}
\newtheorem*{lem}{Lemma}
\newtheorem{corollary}[lemma]{Corollary}
\theoremstyle{definition}
\newtheorem*{theorem}{theorem}
\theoremstyle{definition}
\newtheorem{definition}{Definition}
\theoremstyle{remark}
\newtheorem*{remark}{Remark}

% TODO notes
\newcommand{\td}[1]{\todo[inline, color=red!20, size=\small]{#1}}
\newcommand{\note}[1]{\todo[inline, color=blue!20, size=\small]{#1}}
\newcommand{\remeber}[1]{\todo[inline, color=green!20, size=\small]{#1}}

% Sets and number systems
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\e}{\epsilon}
\newcommand{\p}{\rho}
\newcommand{\eps}{\epsilon}
\newcommand{\la}{\lambda}
\newcommand{\ol}{\overline}

% Custom commands for linear algebra
\newcommand{\matr}[1]{\begin{pmatrix}#1\end{pmatrix}} % For matrices
\newcommand{\vect}[1]{\begin{bmatrix}#1\end{bmatrix}} % For column vectors
\newcommand{\vct}[1]{\bm{#1}} % For bold vectors
\newcommand{\transp}{^{\mathsf{T}}} % Transpose symbol
\DeclarePairedDelimiter\ip{\langle}{\rangle} % Inner product
\DeclarePairedDelimiter\norm{\lVert}{\rVert} % Norm
\newcommand{\zero}{\mathbf{0}} % Zero vector/matrix
\newcommand{\ident}{\mathbf{I}} % Identity matrix
\DeclareMathOperator{\tr}{tr} % Trace
\DeclareMathOperator{\detm}{det} % Determinant
\DeclareMathOperator{\rank}{rank} % Rank
\DeclareMathOperator{\nullity}{nullity} % Nullity
\newcommand{\blockmat}[2]{\begin{pmatrix} #1 & #2 \end{pmatrix}} % Block matrix with 2 columns
\newcommand{\augmatr}[2]{\left(\begin{array}{#1|#1}#2\end{array}\right)}
\newcommand{\bmfour}[4]{\left( \begin{array}{c|c} #1 & #2 \\ \hline #3 & #4 \end{array} \right)} % 2x2 block matrix with lines
\newcommand{\blockvect}[2]{\begin{bmatrix} #1 \\ #2 \end{bmatrix}} % Block vector with 2 rows
% Define custom colors
\definecolor{bg}{rgb}{0.95,0.95,0.92}
\definecolor{codeblue}{rgb}{0.25,0.5,0.75}
\definecolor{keyword}{rgb}{0.5,0,0.5}
\definecolor{string}{rgb}{0,0.5,0}
% Define the style for IPython
\lstdefinelanguage{ipython}{
  basicstyle=\ttfamily\footnotesize\color{black},
  keywordstyle=\color{keyword}\bfseries,
  stringstyle=\color{string},
  backgroundcolor=\color{bg},
  morekeywords={In,Out},
  frame=lines,
  numbers=left,
  numbersep=5pt
}
% Define the style for Julia
\lstdefinelanguage{julia}{
  keywords={struct, abstract, primitive, typealias, bitstype, mutable, module, baremodule, import, importall, using, export, if, else, elseif, for, while, break, continue, function, return, type, global, local, const, let, do, try, catch, finally, end, quote, macro, where},
  basicstyle=\ttfamily\footnotesize\color{black},
  keywordstyle=\color{keyword}\bfseries,
  stringstyle=\color{string},
  backgroundcolor=\color{bg},
  frame=lines,
  numbers=left,
  numbersep=8pt,
  inputencoding=utf8,
  extendedchars=true,
  escapeinside={(*}{*)},
  literate={~}{{$\sim$}}1
           {₁}{{\textsubscript{1}}}1
           {₂}{{\textsubscript{2}}}1
           {₃}{{\textsubscript{3}}}1
           {ᵀ}{{$^{\mathrm{T}}$}}1
           {⋅}{{$\cdot$}}1
           {∈}{{$\in$}}1
           {ℝ}{{$\mathbb{R}$}}1
           {→}{{$\to$}}1
           {π}{{$\pi$}}1
           {≤}{{$\leq$}}1
           {≥}{{$\geq$}}1
           {≈}{{$\approx$}}1
           {ϵ}{{$\epsilon$}}1
           {κ}{{$\kappa$}}1
           {Δ}{{$\Delta$}}1
           {λ}{{$\lambda$}}1
}

% Define the style for Mathematica
\lstdefinelanguage{Mathematica}{
  keywords={Module,With,Block,If,Then,Else,Which,Switch,For,While,Return,Do,Table,Plot,Map,Apply,Function,Set,SetDelayed,Clear,Quit,NonlinearModelFit,FindMinimum,FindMaximum,FindRoot,NIntegrate,Integrate,Simplify,FullSimplify,DSolve,RSolve,NSolve,NDSolve,Limit,Series,Assuming,Expand,Factor,TableForm,MatrixForm,Part,Length,Dimensions,Transpose,MapThread,MapAt,Flatten,Thread,Join,Outer,ConstantArray,Riffle,ArrayPlot,Plot3D,ContourPlot,ParametricPlot,MatrixPlot,Graphics,Graphics3D,Manipulate,Evaluate,Sin,Cos,Exp,Log,Sqrt},
  keywordstyle=\color{keyword}\bfseries,
  sensitive=true,
  morecomment=[l]{(*}, morecomment=[r]{*)},
  commentstyle=\itshape\color{gray},
  morestring=[b]",
  stringstyle=\color{string},
  basicstyle=\ttfamily\footnotesize\color{black},
  backgroundcolor=\color{bg},
  frame=lines,
  numbers=left,
  numbersep=5pt,
  showstringspaces=false,
  escapeinside={(*}{*)}
}

% Optionally define a style for Mathematica code cells
\lstdefinestyle{mathematicaStyle}{
  language=Mathematica,
  frame=lines,
  backgroundcolor=\color{bg},
  basicstyle=\ttfamily\footnotesize,
  keywordstyle=\color{keyword}\bfseries,
  commentstyle=\itshape\color{gray},
  stringstyle=\color{string},
  numbers=left,
  numbersep=5pt,
  showstringspaces=false
}